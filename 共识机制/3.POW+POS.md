# POW 与 POS 混合共识

## 混合共识算法定义

现在很多公链都是在用基于xx和xx算法的混合共识算法实现共识机制的。什么是混合共识算法呢？  
有两种情况都可以认为是混合机制：  
1.在某个算法的基础上，运用其他算法的技术进行改进。如点点币，它的共识机制是用pos算法对pow算法进行改进后的机制，不过大家往往认为点点币的共识机制是pos，其实严格来说是pow+pos的。  
2.两个算法运算相互独立，但共同组成了一个共识机制。如初链，它的共识是pow和pbft两个算法组成的，然后自己给自己起了个新名字叫混合共识机制fpow。这种混合很明显，所以大家都会叫混合机制。


## 点点币的混合共识机制

> 点点币的共识算法是基于POW改进的POS算法。

点点币虽然是基于POS发行的数字货币，但与POW一样，为了抢到打包区块的权利，节点同样要进行hash计算，只不过最终的解和币龄有关，计算公式：  

```bash
proofHash < coinAge * target

# coinAge是币龄，target是一个目标值，用于调整难度。
# coinAge * target的值越大，难度就越小，抢到区块的概率就越高。
# 假如你的钱包里是0个币，那么你的币龄就是0, 计算一个小于0的hash值根本不可能，因此抢不到区块。
# proofHash也就是pow的挖矿函数，即两次sha256 hash运算。
```

## 点点币的目标值

点点币难度值是一个一直动态调整的，每隔2个区块就调整一次难度（目标值），使出块时间维持在10分钟左右。  

点点币使用目标值来衡量挖矿难度，目标值与难度成反比，目标值越大、难度越小；反之亦然。当前区块的目标值与前一个区块目标值、前两个区块的时间间隔有关。  

计算公式如下：

```bash
当前区块目标值 = 前一个区块目标值 * (1007 * 10 * 60 + 2 * 前两个区块时间间隔) / (1009 * 10 * 60)

# 由公式可见，两个区块目标间隔时间即为10分钟。
# 如果前两个区块时间间隔大于10分钟，目标值会提高，即当前区块难度会降低。
# 反之，如果前两个区块时间间隔小于10分钟，目标值会降低，即当前区块难度会提高。
# 点点币的挖矿难度值=创始区块目标值/当前区块目标值。
```